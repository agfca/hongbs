/*是否显示子表*/function flag() {    return level=='1'||level=='2'||level=='3'||level=='4'||level=='5'||level=='6'    ||level=='7'||level=='7_11_12'||level=='8'||level=='9'||level=='15'    ||level=='16'||level=='16_17'||level=='17'||level=='17_16'?true:false;}$('#user6Json').bootstrapTable({    url: '/order/?orderStatu='+level, // 生产安排，后勤主管，后勤销售主管    method : "GET",    search:true,//搜索框    uniqueId:'id',//主键列    pagination:true,//启用分页    paginationLoop:false,//页码循环    sidePagination:'client',//客户端分页    pageSize:10,    pageList:[5,10,15,20],    //sortName:'id',//自定义排序列    //sortOrder:'desc',//倒序    showColumns:true,//选择显示columns    //detailView:true,//详细页面模式    toolbar:'#toolbar',//指定工具栏    undefinedText:'-',//undefined时显示字符    smartDisplay:true,//智能切换视图    maintainSelected:true,//切换页面记录选中的按钮    //singleSelect:true,//禁止多选    clickToSelect:true,//点击行时选中    //cardView:true,//手机端视图    //showPaginationSwitch:true,    //showHeader:true,//显示表头    //showFooter:true,//显示表尾    selectItemName:'btSelectItem',//	radio or checkbox 的字段名    detailView:flag(),//显示子父表    // 处理数据返回    responseHandler: function(result) {        return result;    },    columns: [{        field: 'orderName',        title: '订单名称',    }, {        field: 'oddNum',        title: '单号'    }, {        field: 'partyA',        title: '甲方'    }, {        field: 'userName',        title: '销售'    }, {        field: 'fileName',        title: '下单人'    }, {        field: 'orderTime',        title: '下单时间'    }, {        field: 'orderStatu',        title: '订单状态',        formatter: function (value, row, index) {            return getOrderStatu(value);        }     }, {        field: 'deliveryTime',        title: '交货时间'    }, {        field: 'remark',        title: '备注'    }, {        field: 'id',        title: '操作',        formatter:function (value, row, index){            return getOperation(row);        }    }],    //注册加载子表的事件。注意下这里的三个参数！    onExpandRow: function (index, row, $detail) {        childTable(index, row, $detail);    },});//订单配置表  子表var childTable = function (index, row, $detail) {    var orderId = row.id;    cur_table = $detail.html('<table></table>').find('table');    $(cur_table).bootstrapTable({        url: 'order/infos/'+orderId,        method: 'get',        //处理数据返回        responseHandler: function(result) {            return result;        },        columns: [{            field: 'orderid',            title: "序号",            formatter: function (value, row, index) {                return index+1;            }        }, {            field: 'infoName',            title: '配置名称',        }, {            field: 'fabric',            title: '面料',            formatter: function (value, row, index) {                var tempHtml = "";                var fabricArr = eval(value);                if(fabricArr!=null&&fabricArr.length>0){                    for(var i = 0; i<fabricArr.length; i++){                        tempHtml += fabricArr[i].name +":"+ fabricArr[i].color+"，&nbsp;";                    }                }                return tempHtml;            }        }, {            field: 'style',            title: '款式'        }, {            field: 'gongyi',            title: '工艺'        }, {            field: 'giveKH',            title: '客户有无样衣'        }, {            field: 'containFabric',            title: '含量'        }, {            field: 'logoStation',            title: '校徽位置'        }, {            field: 'total',            title: '总数'        }, {            field: 'id',            title: '操作',            formatter:function (value, row, index) {                var strTemp = "<button type='button' class='btn btn-info btn-sm' onclick='findOrderInfo("+value+")'>"                    +"查看详情</button>";                return strTemp;            }        }],    });};/*获取制版文件*/function getFile(orderId,filePath) {    window.open("/word/"+orderId+"/"+filePath);}/*layer  确认复核完毕*/function confirmPutOrder(orderId,orderStatu){    if("11"==orderStatu||"12"==orderStatu){// 到11_1 11_2 11_3        // orderStatu = $("#select" + orderId).val();        // 查出这个订单是哪个部门的销售人员下的单子 就转到哪个部门那里去        $.ajax({            url : "/order?method=findStatuById",            type : "POST",            data : {id:orderId},            success : function(data) {                if(orderStatu=='11'){                    orderStatu=data;                }else if(orderStatu=='12'){                    if(data=='111'){                        orderStatu='131';                    }else if(data=='112'){                        orderStatu='132';                    }else if(data=='113'){                        orderStatu='133';                    }                }                /*最终更改orderStatu的function*/                changeOrderStatu(orderId,orderStatu);            },            error : function(data) {                alert("网络故障，请重试");            }        });    } else{        if(orderStatu=='112'||orderStatu=='111'||orderStatu=='113'){            orderStatu='12';        }else if('16'==orderStatu){            orderStatu='7';        }else if('17'==orderStatu){            orderStatu='8';        }else if('7'==orderStatu){            orderStatu='17';        }else if('9'==orderStatu){            orderStatu='15';        }else if(orderStatu=='131'||orderStatu=='132'||orderStatu=='133'){            orderStatu='0';        }else if('15'==orderStatu){            orderStatu = $("#select" + orderId).val();        }else{            orderStatu = parseInt(orderStatu)+1;        }        /*最终更改orderStatu的function*/        changeOrderStatu(orderId,orderStatu);    }}/*最终更改orderStatu的function*/function changeOrderStatu(orderId,orderStatu) {    $.ajax({        url : "/order/"+orderId+"",        type : "PUT",        data : {orderStatu:orderStatu},        beforeSend:function(){            index = layer.msg('提交中...', {icon: 16,time: 20000,shade:0.01});        },        success : function(data) {            layer.close(index);            layer.msg(data);            $("#user6Json").bootstrapTable("refresh");        },        error : function(data) {            alert(data.status);            //$( '#serverResponse').html(data.status + " : " + data.statusText + " : " + data.responseText);        }    });}/*复核订单*/function putOrder(orderId,orderStatu){    layer.msg('确认提交？', {        time: 0 //不自动关闭        ,shade:0.01        ,btn: ['确认', '取消']        ,yes: function(index){            layer.close(index);            confirmPutOrder(orderId,orderStatu);        }    });}/*查看配置详情*/function findOrderInfo(infoId){    window.open('/orderDetail/info/'+infoId);}